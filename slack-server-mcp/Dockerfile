# Generated by https://smithery.ai. See: https://smithery.ai/docs/config#dockerfile
FROM python:3.10-slim-bullseye

# Update system packages to address vulnerabilities
RUN apt-get update && apt-get upgrade -y && apt-get clean && rm -rf /var/lib/apt/lists/*

# Install uv
COPY --from=ghcr.io/astral-sh/uv:latest /uv /bin/uv

# Set a working directory
WORKDIR /app

# Create cache directory for uv with proper permissions
RUN mkdir -p /tmp/.cache/uv && chmod -R 777 /tmp/.cache/uv && chown -R 1000:1000 /tmp/.cache/uv

# Set UV_CACHE_DIR environment variable
ENV UV_CACHE_DIR=/tmp/.cache/uv

# Copy only necessary files to leverage Docker layer caching
COPY pyproject.toml uv.lock* README.md ./

# Install Python dependencies using uv
RUN UV_CACHE_DIR=/tmp/.cache/uv uv sync --frozen

# Change ownership of the virtual environment to user 1000
RUN chown -R 1000:1000 /app/.venv

# Copy all files to the container
COPY . .

# Sensitive environment variables should be provided securely at runtime, not in the Dockerfile.
# Example: docker run -e SLACK_BOT_TOKEN=your_bot_token -e SLACK_USER_TOKEN=your_user_token ...

# Command to run the MCP server using the virtual environment's python
CMD ["/app/.venv/bin/python", "slack_mcp_server.py"]